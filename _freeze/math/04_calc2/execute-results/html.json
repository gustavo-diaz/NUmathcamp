{
  "hash": "dc03451af4d8d2590e954922360c9788",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Calculus II\"\nauthor: \"[Gustavo Diaz](https://gustavodiaz.org)\"\ndate: last-modified\ndate-format: long\nnumber-sections: true\ntoc: true\n---\n\n\n## Overview\n\nLast time, we learned about calculus as a way to deal with continuity usefully and discussed derivatives as one of the primary operations in calculus. \n\nToday, we review two remaining topics. First, we revisit derivatives to understand how computers calculate them. Second, we discuss integrals, or \"anti-derivatives,\" as the other important operation in calculus.\n\n\n## How do computers calculate derivatives?\n\nIn quite a few statistics and machine learning problems, computers need to compute derivatives of arbitrarily complex functions, perhaps millions of times. How do they do it? (see [Baydin et al. 2018](https://dl.acm.org/doi/abs/10.5555/3122009.3242010) for discussion of these three approaches)\n\n-   Symbolic differentiation: automatically combine the rules of differentiation (power rule, product rule, etc.). Math solvers like [WolframAlpha](https://www.wolframalpha.com/calculators/derivative-calculator/) or [Mathematica](https://www.wolfram.com/mathematica/) do\n\n-   Numerical differentiation: infer the derivative by computing the function at different sample values (like we did with $y=x^2$ before. For example, this is what the R function `optim()` does behind the scenes.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# minimize the x^2 + 5 function:\noptim(par = 0, fn = function(x){x ^ 2 + 5}, method = \"L-BFGS-B\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$par\n[1] 0\n\n$value\n[1] 5\n\n$counts\nfunction gradient \n       1        1 \n\n$convergence\n[1] 0\n\n$message\n[1] \"CONVERGENCE: NORM OF PROJECTED GRADIENT <= PGTOL\"\n```\n\n\n:::\n:::\n\n\n<!-- Practice: Solve some of the derivatives we did yesterday via optim -->\n\n-   Automatic differentiation: track how every function is constructed from (differentiable) elementary computer operations (e.g., binary arithmetic), and get the result using the chain rule. Implemented in the [`torch`](https://torch.mlverse.org/) R package, the [`TensorFlow`](https://www.tensorflow.org/), [`PyTorch`](https://pytorch.org/), and [`JAX`](https://jax.readthedocs.io/en/) Python libraries, and the [`ReverseDiff.jl`](https://juliadiff.org/ReverseDiff.jl/) and [`Zygote.jl`](https://fluxml.ai/Zygote.jl/) Julia packages.\n\n## Optimization\n\n*Optimization* allows us to find the minimum or maximum values (or *extrema*) a function takes. It has many applications in the social sciences:\n\n-   Formal theory: utility maximization, continuous choices\n\n-   Ordinary Least Squares (OLS): Focuses on *minimizing* the squared errors between observed data and model-estimated values\n\n-   Maximum Likelihood Estimation (MLE): Focuses on *maximizing* a likelihood function, given observed values.\n\n### Extrema\n\nInformally, a maximum is just the highest value a function takes, and a minimum is the lowest value. We use the term \"extrema\" to define a general family of extreme values of a function.\n\nIn some situations, it can be easy to identify extrema intuitively by looking at a graph of the function.\n\n- Maxima are high points (\"peaks\")\n\n- Minima are low points (\"valleys\")\n\nWe can use derivatives (rates of change!) to get at extrema.\n\n### Critical points and the First-Order Condition\n\nAt critical points (or stationary points), the derivative is zero or fails to exist. At these, the function has *usually* reached a (local) maximum or minimum.\n\n- At a maximum, the function must be increasing before the point and decreasing after it.\n\n- At a minimum, the function must be decreasing before the point and increasing after it.\n\nLocal extrema occur at critical points, but not all critical points are *global* extrema. For instance, sometimes the graph is changing between concave and convex (\"inflection points\"). Or sometimes the function is not differentiable at that point for other reasons.\n\nWe can find the local maxima and/or minima of a function by taking the derivative, setting it equal to zero, and solving for $x$ (or whatever variable). This gives us the First-Order Condition (FOC).\n\n$$FOC: f'(x)=0$$\n\n### Second-Order Condition\n\nNotice that after this we only know that there is a critical point. **BUT** we don't know if we've found a maximum or minimum, or even if we've found an extremum.\n\nTo determine whether a we are seeing a (local) maximum or minimum, we can use the **Second Derivative Test**:\n\n-   Start by identifying $f''(x)$\n\n-   Substitute in the stationary points $(x^*)$ identified from the FOC.\n\n    -   $f''(x^*) > 0$ we have a local minimum\n\n    -   $f''(x^*) < 0$ we have a local maximum\n\n    -   $f''(x^*) = 0$ we (may) have an inflection point - need to calculate higher-order derivatives (don't worry about this for now)\n\nCollectively these give us the **Second-Order Condition (SOC)**.\n\n<!-- Let's do this procedure and obtain the FOC and SOC for $\\displaystyle y=\\frac{1}{2} x^3 + 3 x^2 - 2$ on the board. What do we learn? Compare this with the plot of the function on [Desmos](https://www.desmos.com/calculator). -->\n\n### Local or global extrema?\n\nNow when it comes to knowing whether extrema are local or global:\n\n-   Here we use the **Extreme value theorem**, which states that if a real-valued function is continuous on a closed and bounded (finite) interval, the function must have a global minimum and a global maximum on that interval at least once. Importantly, in this situation the global extrema exist, and **they are either at the local extrema or at the boundaries** (where we cannot even find critical points).\n\n-   So to find the minimum/maximum on some interval, compare the local min/max to the value of the function at the interval's endpoints. So, if the interval is $(-\\infty, +\\infty)$, check the function's limits as it approaches $-\\infty$ and $+\\infty$. \n\n<!-- Let's try this last step for our example above, $\\displaystyle y=\\frac{1}{2} x^3 + 3 x^2 - 2$, to get the global extrema in the entire domain. -->\n\n<!-- ::: callout-note -->\n<!-- #### Exercise -->\n\n<!-- Identify the global extrema of the function $\\displaystyle \\frac{x^3}{3} - \\frac{3}{2}x^2 -10x$ in the interval $[-6, 6]$. -->\n<!-- ::: -->\n\n## Integrals\n\nDerivatives allow us to calculate the instantaneous change (slope) in a continuous function at a given point. What if, instead of describing change at specific points, we wanted to characterize the *net effect* of change of a function. With what we know so far, we would start by calculating slopes at different parts of the function and then summing them all up together, but we have a *continuous* function, so simply adding up at discrete values would not work. \n\nThat is where integration comes in. Informally, we can think of integrals as the flip side of derivatives.\n\nWe can motivate integrals as a way of finding the area under a curve. Sometimes finding the area is easy. What's the area under the curve between $x=-1$ and $x=1$ for this function?\n\n$$\nf(x) = \n\\begin{cases}\n\\frac{1}{3} & \\text{for } x \\in [0, 3] \\\\\n0 & \\text{otherwise}\n\\end{cases}\n$$\n\n<!-- Practice: Do it by hand! -->\n\n::: {.callout-note collapse=true}\n## Answer\n\nThe are is 1/3, we will do this together when we meet, but the essence of the answer is drawing the function and then calculating the area of a rectangle.\n\n:::\n\nNormally, finding the area under a curve is much harder. But this is basically the question behind integration.\n\n### Integrals are about infinitesimals too\n\nLet's say we have a function $y = x^2$ And we want to find the area under the curve from $x=0$ to $x=1$. How would we do this?\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse) # could also just do library(ggplot2)\nggplot() +\n  # draw main function\n  stat_function(fun = function(x){x ^ 2}, xlim = c(-2, 2)) +\n  # fill area under the curve between x = 0 and x = 1\n  geom_area(mapping = aes(x = 0), stat = \"function\",\n            fun = function(x){x ^ 2}, xlim = c(0, 1), fill = \"red\")\n```\n\n::: {.cell-output-display}\n![](04_calc2_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n:::\n\n\nOne way to approximate this area is by drawing narrow rectangles that cover the area in red.\n\n<!-- SHOW ON WHITE BOARD -->\n\nThat would be a rough approximation, but it gets better and better the narrower the rectangles are\n\n$$\nArea = lim_{\\Delta x \\to 0}\\sum_i^n{f(x) \\cdot \\Delta x}\n$$\n\n, where $\\Delta x$ is the width of the rectangles and $n$ is their number. In words, this says that the are is equal to the sum of all the rectangles when the limit of the rectangle with approximates zero.\n\nThis is actually one way to define the **definite integral**, $\\displaystyle\\int_a^bf(x)dx$ (also known as the Riemann integral). We'll learn how to compute these in a few moments.\n\n### Indefinite integrals as antiderivatives\n\nThe **indefinite integral**, also known as the **antiderivative**, $F(x)$ is the inverse of the function $f'(x)$. \n\n\n$$F(x)= \\displaystyle\\int f(x) \\text{ } dx$$\n\nBeing inverse operations means that if you apply them in sequence you are back to the original place, so if you take the derivative of $F(x)$, you wind up back at $f(x)$. \n\n$$F' = f \\text{ or } \\displaystyle\\frac{dF(x)}{dx} = f(x)$$\n\nThis definition is annoyingly recursive, but useful enough to characterize the inverse operation of a derivative.\n\nTo illustrate, what is the antiderivative for a constant function $f(x) = 1$? Is there just one? (this example comes from [Moore and Siegel, 2013](https://press.princeton.edu/books/paperback/9780691159171/a-mathematics-course-for-political-and-social-research), p. 137).\n\nBy power rule, we know the derivative of x is 1. So $F(x) = x$ is one anti-derivative. But it is not the only one! The derivatives of $F(x) = x + 10 $ and $F(x) = x + 100$ are also 1. We can anticipate this and just say that the anti-derivative of $f(x) = 1$ i just $F(x) = x + C$ where $C$ is any constant number. We call $C$ the \"constant of integration.\"\n\nWhat we just did is a process called *anti-differentiation*. We can use this concept to help us solve definite integrals!\n\n### Solving definite integrals\n\nThere are two kinds of integrals, an **indefinite integral** is just the anti-derivative as defined above, we which express as $\\displaystyle\\int f(x)dx = F(x)$, meaning that the output is a function.\n\n**Definite integrals** instead return a value that represents the are under a curve, which means we need to specify a range to evaluate the area in question.\n\nOne way to calculate definite integrals, known as **THE FUNDAMENTAL THEOREM OF CALCULUS** is shown below:\n\n$$\\displaystyle\\int_{a}^{b} f(x) \\text{ } dx = F(b)-F(a) = F(x)\\bigg|_{a}^{b}$$\n\nIn words, the definite integral from point $a$ to $b$ of $f(x)$ with respect to $dx$ is the difference of the anti-derivatives evaluated at the upper and lower limit.\n\nThis implies that to calculate a definite integral, we first determine the antiderivative (indefinite integral) of $f(x)$ (and represent it $F(x)$), substitute the upper limit first and then the lower limit one by one, and subtract the results in order.\n\n### Rules of integration\n\nMany of the rules of integration have counterparts in differentiation.\n\n**Coefficient rule:** $\\displaystyle\\int c f(x)\\,dx = c \\int f(x)\\,dx$\n\n**Sum/difference rule:** $\\displaystyle\\int (f(x) \\pm g(x))\\,dx = \\int f(x)\\,dx \\pm \\int g(x)\\,dx$\n\n**Constant rule:** $\\displaystyle\\int c\\,dx = cx + C$\n\n**Power rule:** $\\displaystyle\\int x^n\\,dx = \\frac{x^{n+1}}{n+1} + C \\qquad \\forall n \\neq -1$\n\n**Reciprocal rule:**$\\displaystyle\\int \\frac{1}{x}\\,dx = \\ln(x) + C$\n\n**Exponent and logarithm rules:**\n\n$$\n\\begin{aligned}\n\\displaystyle \\int e^x \\,dx &= e^x+C \\\\\n\\displaystyle \\int c^x \\,dx &= \\frac{c^x}{ln(c)}+C\\\\\n\\\\\n\\displaystyle \\int ln(x) \\,dx &= x \\cdot ln(x) - x+C \\\\\n\\displaystyle \\int log_c(x) \\,dx &= \\frac{x \\cdot log_c(x) - x}{log_c(x)}+C \n\\end{aligned}\n$$\n\nThe final two rules are analog to the product rule and the chain rule:\n\n**Integration by parts:** $\\displaystyle \\int f(x)g'(x)\\,dx = f(x)g(x) - \\int f'(x)g(x)\\,dx$\n\nThis rule allows you to change around your functions. If you cannot integrate $f(x)g'(x)$ but you can integrate $g'(x)$ and $f'(x)g(x)$ then it is useful. This applicable when $g'(x)$ is something like $e^x$ that does not get more complex when you integrate, while $f(x)$ is something like $x$ that simplifies when you differentiate it. \n\n**Integration by substitution:** \n\n$$\n\\begin{aligned}\n1.& \\text{ Have }\\displaystyle \\int f(g(x))g'(x)\\,dx \\\\\n2.& \\text{ Set u=g(x)} \\\\\n3.& \\text{ Compute } \\int f(u)\\,du \\\\\n4.& \\text{ Replace u for g(x)}\n\\end{aligned}\n$$\n\nIn words, we can change variables to an entirely different function if it helps us to compute the integral. We do this when the integral contains a composite function that one cannot integrate easily, like $f(x) = \\displaystyle \\frac{1}{2\\pi} x e^{-\\frac{x2}{2}}$, which happens to be the probability distribution function of a standard normal distribution multiplied by x.\n\n<!-- Do this one on the board if we have time -->\n\nIf this was a Calculus I course, we would spend a whole midterm practicing tricky problems involving integration by parts or by substitution. We will not bothers with this at math camp.\n\n<!-- Let's do an example on the board: $\\displaystyle \\int e^{x^2} 2x  \\,dx$. -->\n\n### An example\n\nRemember our function $y=x^2$ and our goal of finding the area under the curve from $x=0$ to $x=1$. We can describe this problem as $\\displaystyle \\int_0^1 x^2 dx$\n\nFind the indefinite integral, $F(x)$\n\n$$\n\\displaystyle\\int x^2 \\text{ } dx = \\displaystyle\\frac{x^3}{3}+C\n$$\n\nNow we'll use the fundamental theory of calculus. Evaluate at our lowest and highest points, $F(0)$ and $F(1)$:\n\n- $F(0) = 0 + C$\n\n- $F(1) = \\displaystyle\\frac{1}{3} + C$\n\nCalculate $F(1) - F(0)$ \n\n$$\\displaystyle\\frac{1}{3} + C - (0 + C)= \\displaystyle\\frac{1}{3} - 0 = \\displaystyle\\frac{1}{3}$$\n\nNote how the constants of integration cancel out. One way to think about this is that the area under a curve would not change if you shift that curve's position along the horizontal axis.\n\n<!-- ::: callout-note -->\n<!-- #### Exercise -->\n\n<!-- Solve the following indefinite integrals: -->\n\n<!-- 1.  $\\int x^2 \\text{ } dx$ -->\n\n<!-- 2.  $\\int 3x^2\\text{ } dx$ -->\n\n<!-- 3.  $\\int x\\text{ } dx$ -->\n\n<!-- 4.  $\\int (3x^2 + 2x - 7\\text{ })dx$ -->\n\n<!-- 5.  $\\int \\dfrac{2}{x}\\text{ }dx$ -->\n\n<!-- And solve the following definite integrals: -->\n\n<!-- 1.  $\\displaystyle\\int_{1}^{7} x^2 \\text{ } dx$ -->\n\n<!-- 2.  $\\displaystyle\\int_{1}^{10} 3x^2 \\text{ } dx$ -->\n\n<!-- 3.  $\\displaystyle\\int_7^7 x\\text{ } dx$ -->\n\n<!-- 4.  $\\displaystyle\\int_{1}^{5} 3x^2 + 2x - 7\\text{ }dx$ -->\n\n<!-- 5.  $\\int_{1}^{e} \\dfrac{2}{x}\\text{ }dx$ -->\n<!-- ::: -->",
    "supporting": [
      "04_calc2_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}